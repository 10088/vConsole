<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <title>Test: Log</title>
  <link href="./lib/weui.min.css" rel="stylesheet"/>
  <link href="./lib/demo.css" rel="stylesheet"/>
  <style>
    .section {
      padding: 0 0 12px;
    }
    .section .hd {
      text-align: center;
      font-size: 18px;
      line-height: 2;
      color: #225fba;
    }
  </style>

  <!-- <script src="../dist/vconsole.min.js"></script> -->
  <!-- <script src="https://unpkg.com/vconsole/dist/vconsole.min.js"></script> -->
</head>
<body ontouchstart>
  <div id="page" class="page">
    <div class="section">
      <div class="hd">Object</div>

      <a onclick="normalObject()" href="javascript:;" class="weui_btn weui_btn_default">Common Object</a>
      <a onclick="largeObject()" href="javascript:;" class="weui_btn weui_btn_default">Large Object</a>
      <a onclick="circularObject()" href="javascript:;" class="weui_btn weui_btn_default">Circular Object & Array</a>
    </div>

    <div class="section">
      <div class="hd">Common Log</div>

      <a onclick="allDataTypes()" href="javascript:;" class="weui_btn weui_btn_default">All Data Types</a>
      <a onclick="logTypes()" href="javascript:;" class="weui_btn weui_btn_default">Log Types</a>
      <a onclick="formattedLog()" href="javascript:;" class="weui_btn weui_btn_default">Different Log Panel</a>
      <a onclick="styledLog()" href="javascript:;" class="weui_btn weui_btn_default">Styled Log</a>
      <a onclick="repeatLog()" href="javascript:;" class="weui_btn weui_btn_default">Repeated Log</a>
    </div>

    <div class="section">
      <div class="hd">Exception</div>

      <a onclick="windowError()" href="javascript:;" class="weui_btn weui_btn_default">window.error</a>
      <a onclick="promiseReject()" href="javascript:;" class="weui_btn weui_btn_default">Promise Reject</a>
      <a onclick="xssLog()" href="javascript:;" class="weui_btn weui_btn_default">XSS Log</a>
    </div>
  </div>
</body>
</html>

<script type="module">
import '../dist/vconsole.min.js';

window.vConsole = new window.VConsole({
  maxLogNumber: 1000,
  // disableLogScrolling: true,
  // theme: 'dark',
  defaultPlugins: [],
  onReady: function() {
    console.log('vConsole is ready.');
  },
  onClearLog: function() {
    console.log('on clearLog');
  }
});
</script>

<script>
// setInterval(() => {
//   console.log(Math.random());
//   console.log('[system]', Math.random());
// }, 300);

class FooClass {
  constructor() {
    this.bar = 'foo';
  }
};

function formattedLog() {
  console.log('[default]', 'This log should be shown in Log panel.');
  console.log('[default]', 'Switch to System tab to see next log.');
  console.log('[system]', 'This log should be shown in System panel.');
  console.log('[foobar]', 'This log should be shown in Log panel. (No "foobar" plugin.)');
}

function styledLog() {
  console.log('%c red %c blue %c log.', 'color:red', 'color:blue', 'font-weight:bold', 'Use %c format.');
}

function normalObject() {
  const obj = {
    number: 233,
    string: 'Hi you!\nFoo\t<b>bar!!</b>',
    boolean: true,
    symbolValue: Symbol('foo'),
    bigint: 98979695949n,
    obj: {foo: 'bar'},
    array: [8, 7, 6],
    func: function foo(a) { alert('b'); },
    class: FooClass,
    classInstance: new FooClass(),
  };
  obj[Symbol('symbolKey')] = 'The key is a symbol.';
  console.log('A common object:', obj);
}

function circularObject() {
  var obj = {
    foo: 'bar'
  };
  obj.self = obj;
  obj.next = {};
  obj.next.next = obj.next;
  obj.next.self = obj;
  console.log('A cyclically referenced object:', obj);

  var arr = [];
  arr[0] = 'foo';
  arr[1] = arr;
  console.log('A cyclically referenced array:', arr);
}

function largeObject() {
  var obj = {
    window: window,
  };
  console.log('largeObject', obj);
}

function allDataTypes() {
  console.log('String:', 'The first line;\nThe second line.', '<b>A HTML tag line.</b>');
  console.log('Number:', 65535);
  console.log('BigInt:', 99987654321n);
  console.log('Boolean:', true, false);
  console.log('Null:', null);
  console.log('Undefined:', undefined);
  console.log('Symbol:', Symbol('Foo'));
  console.log('Array:', [0,1,2,3,4,5,6,7,8,9,10,11]);
  console.log('Object:', {'foo': 'bar'});
  console.log('Function:', allDataTypes);
  console.log('Class:', FooClass);
  console.log('ClassInstance:', new FooClass);
}

function logTypes() {
  console.log('console.log()');
  console.info('console.info()');
  console.debug('console.debug()');
  console.warn('console.warn()');
  console.error('console.error()');
}

function repeatLog() {
  console.log('repeatLog() Start');
  var a = {a: {b: 1}};
  var count = 0;
  var timer = setInterval(() => {
    count ++;
    console.log('repeat', 'foo bar', function(){});
    if (count >= 10) {
      clearInterval(timer);

      console.log('repeat', a);
      console.log('repeat', a);
      console.log('repeatLog() End');
    }
  }, 50);
}

function windowError() {
  console.log(Error);
  a.b = 1;
}

function promiseReject() {
  Promise.reject('reject a string');
  Promise.reject(new Error('reject an Error'));
  Promise.reject({message: 'reject an object'});
  Promise.reject(666).then((result) => {
    console.log('resolved', result);
  }, (result) => {
    console.log('rejected', result);
  });
}

function xssLog() {
  const arr = [
    "-->\tyo\n'\"/><iframe>",
    ["-->\tyo\n'\"/><iframe>"]
  ];
  const obj = {
    'key': 'foo\nbar\tyoo',
    "-->\tyo\n'\"/><iframe>": "-->\n'\"/><iframe>"
  };
  console.log('XSS str:', "-->\tyo\n'\"/><iframe>");
  console.log(arr);
  console.log(obj);
}

</script>